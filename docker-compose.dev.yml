version: '3.8'

# Development-specific overrides
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  postgres:
    ports:
      - "5432:5432"  # Expose port for local development
    volumes:
      - ./db/seeds:/docker-entrypoint-initdb.d/seeds:ro  # Add seed data

  api:
    build:
      context: ./taskai-server
      dockerfile: Dockerfile
      target: builder  # Use builder stage for hot reload (if configured)
    volumes:
      - ./taskai-server:/app  # Mount source for hot reload
    environment:
      LOG_LEVEL: debug
      LOG_FORMAT: text
    ports:
      - "8080:8080"

  web:
    build:
      context: ./taskai-web
      dockerfile: Dockerfile.dev  # Use development Dockerfile
    volumes:
      - ./taskai-web:/app  # Mount source for hot reload
      - /app/node_modules  # Prevent overwriting node_modules
    environment:
      VITE_API_BASE: http://localhost:8080/api/v1
    ports:
      - "5173:5173"
    command: npm run dev
